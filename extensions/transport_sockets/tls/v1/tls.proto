syntax = "proto3";

package extensions.transport_sockets.tls.v1;

import "google/protobuf/wrappers.proto";

option go_package = "github.com/dubbo-kubernetes/xds-api/extensions/transport_sockets/tls/v1;tlsv1";

// [#next-free-field: 8]
message UpstreamTlsContext {
  // Common TLS context settings.
  //
  // .. attention::
  //
  //   Server certificate verification is not enabled by default. To enable verification, configure
  //   :ref:`trusted_ca<envoy_v3_api_field_extensions.transport_sockets.tls.v3.CertificateValidationContext.trusted_ca>`.
  CommonTlsContext common_tls_context = 1;

  // SNI string to use when creating TLS backend connections.
  string sni = 2;
}

// [#next-free-field: 12]
message DownstreamTlsContext {
  CommonTlsContext common_tls_context = 1;

  // If specified, Envoy will reject connections without a valid client
  // certificate.
  google.protobuf.BoolValue require_client_certificate = 2;
}

// TLS context shared by both client and server TLS contexts.
// [#next-free-field: 17]
message CommonTlsContext {

  // Similar to CertificateProvider above, but allows the provider instances to be configured on
  // the client side instead of being sent from the control plane.
  //
  // DEPRECATED: This message was moved outside of CommonTlsContext
  // and now lives in common.proto.
  //
  // [#not-implemented-hide:]
  message CertificateProviderInstance {
    // Provider instance name. This name must be defined in the client's configuration (e.g., a
    // bootstrap file) to correspond to a provider instance (i.e., the same data in the typed_config
    // field that would be sent in the CertificateProvider message if the config was sent by the
    // control plane). If not present, defaults to "default".
    //
    // Instance names should generally be defined not in terms of the underlying provider
    // implementation (e.g., "file_watcher") but rather in terms of the function of the
    // certificates (e.g., "foo_deployment_identity").
    string instance_name = 1;

    // Opaque name used to specify certificate instances or types. For example, "ROOTCA" to specify
    // a root-certificate (validation context) or "example.com" to specify a certificate for a
    // particular domain. Not all provider instances will actually use this field, so the value
    // defaults to the empty string.
    string certificate_name = 2;
  }

  message CombinedCertificateValidationContext {}



  oneof validation_context_type {
    // Combines the default "CertificateValidationContext" with the SDS-provided dynamic context for certificate
    // validation.
    //
    // When the SDS server returns a dynamic "CertificateValidationContext", it is merged
    // with the default context using "Message::MergeFrom()". The merging rules are as follows:
    //
    // * **Singular Fields:** Dynamic fields override the default singular fields.
    // * **Repeated Fields:** Dynamic repeated fields are concatenated with the default repeated fields.
    // * **Boolean Fields:** Boolean fields are combined using a logical OR operation.
    //
    // The resulting "CertificateValidationContext" is used to perform certificate validation.
    CombinedCertificateValidationContext combined_validation_context = 8;
  }
  reserved 5;
}
